<!DOCTYPE html>
<html lang="en" >

<head>
  <meta charset="UTF-8">
  <title>tgr.am Editor</title>
    <!-- Import Ionicon icons & Google Fonts our Bootstrap theme relies on -->
    <link href="//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Titillium+Web:700|Source+Serif+Pro:400,700|Merriweather+Sans:400,700|Source+Sans+Pro:400,300,600,700,300italic,400italic,600italic,700italic" rel="stylesheet" type="text/css">
    <!-- Import the custom Bootstrap 4 theme from our hosted CDN -->
    <link rel="stylesheet" href="//demo.productionready.io/main.css">
      
    <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-editor/5.23.3/js/medium-editor.min.js"></script>
    <script src="http://ionicabizau.github.io/medium-editor-markdown/dist/me-markdown.standalone.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/medium-editor/5.23.3/css/medium-editor.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/medium-editor/5.23.3/css/themes/default.min.css" type="text/css" media="screen" charset="utf-8">
    <style>
            html {
                height: 100%;
            }
            body {
                margin: 50;
                height: 100%;
            }
        
            /* Tell Quill not to scroll */
            #quill-container {
                height: auto;
                min-height: 100%;
            }
        
            #quill-container .ql-editor {
                font-size: 18px;
                overflow-y: visible; 
            }
        
            /* Specify our own scrolling container */
            #scrolling-container {
                padding-left: 0px;
                height: 100%;
                min-height: 100%;
            }

            .markdown {
                /*visibility:hidden;*/
            }
            </style>
</head>

<body>
{{ template "menu" . }}
<div class="container page" id="scrolling-container">
    <div class="quill-container" id="quill-container" name="quill-container">
        {{.html}}
    </div>
    <div class="markdown" style="display: none;"><pre></pre></div>
    <button type="submit" class="btn btn-lg btn-primary pull-xs-left" onclick="sen()" >Publish</button>
</div>
<script>
    var markDownEl = document.querySelector(".markdown > pre");
    new MediumEditor(document.querySelector(".quill-container"), {
        extensions: {
            markdown: new MeMarkdown(function (md) {
                markDownEl.textContent = md;
            })
        }
    });
    function sen() {
        //alert(markDownEl.textContent)
        var xhr = new XMLHttpRequest();
        var url = "/editor";
        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 201) {
                var json = JSON.parse(xhr.responseText);
                window.location.replace('/@'+ json.Author + '/' + json.ID);
                //console.log(json.ID + ", " + json.Author);
            }
        };
        var data = markDownEl.textContent//JSON.stringify({"email": "hey@mail.com", "password": "101010"});
        xhr.send(data);
    }
</script>

</body>
</html>
